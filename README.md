# Proyecto Base de Datos

## Introducci√≥n al conjunto de datos y al problema a estudiar considerando aspectos √©ticos del conjunto de datos empleado
  Equipo: Julia Rojas Pereyra, Nuria Garcia Valdecasas, Valentina Pineda, Valentina Covarrubias Faure, Alejandro Salas Aguilar

  La base de datos escogida fue la siguiente: 
    https://datos.cdmx.gob.mx/dataset/certificados-de-defuncion-sedesa/resource/fc38b701-964d-4c36-8c63-cca9205ab53f

  *Descripci√≥n general de los datos*
  
    Este conjunto de datos recolecta informaci√≥n ace
    
  *¬øQui√©n los recolecta?*
  
    Los datos son recolectados por la Secretar√≠a de Salud de la Ciudad de M√©xico, a partir de los Certificados de Defunci√≥n.
    Estos son procesados y codificados por m√©dicos codificadores seg√∫n los criterios establecidos por la OMS, y capturados en
    el Subsistema Epidemiol√≥gico y Estad√≠stico de las Defunciones (SEED) a nivel Federal.
    
  *¬øCu√°l es el prop√≥sito de su recolecci√≥n?*
  
    Este conjunto de datos tiene como prop√≥sito el brindar informaci√≥n detallada sobre los fallecimientos que ocurren en
    la Ciudad desde una perspectiva epidemiol√≥gica. Es decir, describir las condiciones de salud de la poblaci√≥n, identificar
    la causa de las enfermedades, controlar las enfermedades y prevenir la aparici√≥n de nuevas enfermedades.
    
  *¬øD√≥nde se pueden obtener?*
    
    Se pueden obtener en el portal de datos abiertos de la Ciudad de M√©xico, al entrar en ese portal hay varias secciones en la que se pueden             consultar conjuntos de datos, los que nosotros usaremos est√°n en la secci√≥n de administraci√≥n y finanzas, donde posteriormente aparecen las           instituciones disponibles, nuestros datos se encuentran ingresando al apartado de secretar√≠a de salud.

  *¬øCon qu√© frecuencia se actualizan?*

    La √∫ltima actualizaci√≥n fue el 7 de julio del 2023, y se cre√≥ el 13 de marzo del 2021. No se especifica cada cuanto tiempo se actualiza pero ya        pas√≥ m√°s de 1 a√±o desde la √∫ltima actualizaci√≥n.
  
  *¬øCu√°ntas tuplas y cu√°ntos atributos tiene el set de datos?*
  
    Nuestro set de datos cuenta con 28 atributos, pero dentro de estos se encuentran unos atributos con diferente nombre pero misma informaci√≥n. Este      set contiene 127286 tuplas.

| Atributo                   | Tipo de dato en SQL (Variable)  | Descripci√≥n                                                   |
|----------------------------|--------------------------------|---------------------------------------------------------------|
| sexo                       | text (Categ√≥rica)             | G√©nero de la persona.                                         |
| fecha_nacimiento           | date (Fecha)               | Fecha de nacimiento de la persona.                           |
| nacionalidad               | text (Categ√≥rica)             | Nacionalidad declarada.                                       |
| lengua_indigena            | text (Categ√≥rica)             | Indica si habla una lengua ind√≠gena.                         |
| estado_civil               | text (Categ√≥rica)             | Estado civil de la persona.                                   |
| entidad_residencia         | text (Categ√≥rica)             | Entidad federativa de residencia.                            |
| municipio_residencia       | text (Categ√≥rica)             | Municipio o alcald√≠a de residencia.                          |
| escolaridad                | text (Categ√≥rica)             | Nivel educativo alcanzado por la persona.                   |
| ocupacion                  | text (Categ√≥rica)             | Ocupaci√≥n o trabajo habitual.                                |
| afiliacion_medica          | text (Categ√≥rica)             | Tipo de afiliaci√≥n m√©dica que tiene la persona.             |
| fecha_defuncion1           | date (Fecha)               | Fecha exacta de la defunci√≥n.                                |
| hora_defuncion             | time (Fecha)               | Hora exacta de la defunci√≥n.                                 |
| lugar_defuncion            | text (Categ√≥rica)             | Lugar donde ocurri√≥ la defunci√≥n.                           |
| entidad_defuncion          | text (Categ√≥rica)             | Entidad federativa donde ocurri√≥ la defunci√≥n.              |
| alcaldia                   | text (Categ√≥rica)             | Alcald√≠a o municipio donde ocurri√≥ la defunci√≥n.            |
| atencion_medica            | text (Categ√≥rica)             | Indica si recibi√≥ atenci√≥n m√©dica antes de la defunci√≥n.    |
| necropsia                  | text (Categ√≥rica)             | Indica si se realiz√≥ necropsia.                             |
| causa_defuncion            | text (Categ√≥rica)             | Causa oficial de la defunci√≥n.                              |
| durante_embarazo           | text (Categ√≥rica)             | Indica si la defunci√≥n ocurri√≥ durante el embarazo.        |
| causado_embarazo           | text (Categ√≥rica)             | Indica si la defunci√≥n fue causada por el embarazo.        |
| complicacion_embarazo      | text (Categ√≥rica)             | Indica si hubo complicaciones relacionadas con el embarazo.|
| muerte_accidental_violenta | text (Categ√≥rica)             | Indica si la muerte fue accidental o violenta.              |
| tipo_evento                | text (Categ√≥rica)             | Tipo de evento relacionado con la muerte.                  |
| en_trabajo                 | text (Categ√≥rica)             | Indica si el evento ocurri√≥ en el trabajo.                 |
| sitio_lesion               | text (Categ√≥rica)             | Lugar f√≠sico donde ocurri√≥ la lesi√≥n.                      |
| municipio_ocurrencia       | text (Categ√≥rica)             | Municipio donde ocurri√≥ el evento.                        |
| fecha_defuncion            | date (Fecha)               | Fecha de la defunci√≥n.                                      |
| edad                       | int (Num√©rica)                | Edad de la persona en a√±os.                                |


 *¬øCu√°l es el objetivo buscado con el set de datos?*
  
    Llevar un control del tipo de gente que muere, si obtuvieron atenci√≥n m√©dica, y el lugar donde murieron. Pueden sacarse
    muchas conclusiones de este set de datos, desde ver √©pocas de mayor mortalidad (como durante la pandemia de covid-19),
    lugares con mayores √≠ndices de mortalidad, o la eficacia de
    atenci√≥n m√©dica.
    
  *¬øPara qu√© se usar√° por el equipo?*
  
    Decidimos utilizar esta base de datos para realizar un an√°lisis detallado de la mortalidad en la Ciudad de M√©xico,
    identificando patrones y tendencias en funci√≥n de variables clave como la causa de muerte (la enfermedad), la edad,
    el g√©nero y la ubicaci√≥n geogr√°fica (alcald√≠a) de los fallecimientos. A trav√©s de la estructuraci√≥n de las entidades
    principales, como defunciones, alcald√≠as y pacientes, se podr√° evaluar qu√© enfermedades son m√°s frecuentes en
    determinados grupos poblacionales y en qu√© zonas de la ciudad se registran las tasas de mortalidad m√°s altas.
    Adem√°s, esta informaci√≥n permitir√° comparar datos a lo largo del tiempo para detectar posibles cambios en las causas
    de defunci√≥n y su relaci√≥n con factores demogr√°ficos o socioecon√≥micos.
    
  *¬øQu√© consideraciones √©ticas conlleva el an√°lisis y explotaci√≥n de dichos datos?*
  
    El an√°lisis de esta base de datos conlleva diversas consideraciones √©ticas, ya que implica el acceso a informaci√≥n sensible sobre personas            fallecidas. Por ello, es fundamental respetar la privacidad y confidencialidad de los datos, asegur√°ndonos de que la informaci√≥n utilizada no         permita identificar a individuos espec√≠ficos, pues esto podr√≠a vulnerar la dignidad de los fallecidos y sus familias. Adem√°s, es importante           evitar sesgos en la interpretaci√≥n de los resultados, ya que una mala contextualizaci√≥n de las cifras podr√≠a llevar a conclusiones err√≥neas o         incluso discriminatorias hacia ciertos grupos poblacionales o regiones.
    
# üìå Carga Inicial y An√°lisis Preliminar  

Para realizar la carga inicial del set de datos a una base de datos de tipo **PostgreSQL**, sigue los siguientes pasos:  

## ‚úÖ Requisitos Previos  
Antes de comenzar, aseg√∫rate de tener:  
- **PostgreSQL** instalado (`psql` o `pgAdmin`).  
- El archivo de datos **CSV** completamente descomprimido:  
  [Certificados de Defunci√≥n - SEDESA](https://datos.cdmx.gob.mx/dataset/certificados-de-defuncion-sedesa).  

---

## 1Ô∏è‚É£ Creaci√≥n de la Base de Datos  
En la consola de **psql**, ejecuta el siguiente comando:  

```sql
CREATE DATABASE mortalidad;
```
## 2Ô∏è‚É£ Creaci√≥n de Tablas en TablePlus
Abre TablePlus y crea una nueva conexi√≥n con la base de datos mortalidad (categor√≠a PostgreSQL).

Abre la opci√≥n SQL Query e ingresa el siguiente comando para crear la tabla:

```sql
CREATE TABLE staging (
    sexo TEXT,
    fecha_nacimiento TEXT,
    nacionalidad TEXT,
    lengua_indigena TEXT,
    estado_civil TEXT,
    entidad_residencia TEXT,
    municipio_residencia TEXT,
    escolaridad TEXT,
    ocupacion TEXT,
    afiliacion_medica TEXT,
    fecha_defuncion TEXT,
    hora_defuncion TEXT,
    lugar_defuncion TEXT,
    entidad_defuncion TEXT,
    alcaldia TEXT,
    atencion_medica TEXT,
    necropsia TEXT,
    causa_defuncion TEXT,
    durante_embarazo TEXT,
    causado_embarazo TEXT,
    complicacion_embarazo TEXT,
    muerte_accidental_violenta TEXT,
    tipo_evento TEXT,
    en_trabajo TEXT,
    lugar_lesion TEXT,
    municipio_ocurrencia TEXT,
    fecha_defuncion_r TEXT,
    edad TEXT
);
```
## 3Ô∏è‚É£ Conexi√≥n a la Base de Datos y Carga Inicial de Datos
Regresa a la consola psql y ejecuta los siguientes comandos:

```sql
\c mortalidad;
SET CLIENT_ENCODING TO 'UTF8';
\copy staging (sexo, fecha_nacimiento, nacionalidad, lengua_indigena, estado_civil, entidad_residencia, municipio_residencia, escolaridad, ocupacion, afiliacion_medica, fecha_defuncion, hora_defuncion, lugar_defuncion, entidad_defuncion, alcaldia, atencion_medica, necropsia, causa_defuncion, durante_embarazo, causado_embarazo, complicacion_embarazo, muerte_accidental_violenta, tipo_evento, en_trabajo, lugar_lesion, municipio_ocurrencia, fecha_defuncion_r, edad) FROM 'path_to_downloaded_csv' WITH (FORMAT CSV, HEADER true, DELIMITER ',');
```
## üìä An√°lisis Preliminar

Para comenzar con el an√°lisis de los datos, ejecutamos los siguientes comandos en **SQL Query** en **TablePlus**:

### 1. **Columnas con valores √∫nicos**
Para identificar si una columna contiene √∫nicamente valores √∫nicos, utilizamos la siguiente consulta:

```sql
SELECT column_name
FROM staging
GROUP BY column_name
HAVING COUNT(DISTINCT column_name) = COUNT(*);
```

üìå **Las columnas con valores √∫nicos fueron:**  
- `municipio_residencia`  
- `fecha_nacimiento`  
- `alcaldia`  
- `causa_defuncion`  
- `municipio_ocurrencia`  

---

### 2. **M√≠nimos y m√°ximos de fechas**
Para obtener el rango de fechas en el dataset, ejecutamos:

```sql
SELECT 
    MIN(fecha_nacimiento) AS fecha_nacimiento_min,
    MAX(fecha_nacimiento) AS fecha_nacimiento_max,
    MIN(fecha_defuncion) AS fecha_defuncion_min,
    MAX(fecha_defuncion) AS fecha_defuncion_max
FROM staging
WHERE fecha_nacimiento NOT IN ('NA');
```

üìå **Resultados:**  
- `fecha_nacimiento_min`: **1900-08-29**  
- `fecha_nacimiento_max`: **2020-12-29**  
- `fecha_defuncion_min`: **2020-01-01**  
- `fecha_defuncion_max`: **2020-12-31**  

---

### 3. **M√≠nimos, m√°ximos y promedios de valores num√©ricos**
Para analizar los valores num√©ricos en la columna `edad`, ejecutamos:

```sql
SELECT 
    MIN(edad::INTEGER) AS edad_min,
    MAX(edad::INTEGER) AS edad_max,
    AVG(edad::NUMERIC) AS edad_promedio
FROM staging
WHERE edad NOT IN ('NA');
```

üìå **Resultados:**  
- `edad_min`: **0 a√±os**  
- `edad_max`: **119 a√±os**  
- `edad_promedio`: **65.48 a√±os**  

---

### 4. **Duplicados en atributos categ√≥ricos**
En este conjunto de datos, la mayor√≠a de las columnas contienen **valores categ√≥ricos**, es decir, datos que representan categor√≠as o grupos espec√≠ficos en lugar de valores num√©ricos continuos.

‚úî **Todas las columnas categ√≥ricas tienen al menos un valor que se repite varias veces**, lo que indica que existen categor√≠as dominantes dentro de cada atributo.

Para analizar la distribuci√≥n de valores en estas columnas, se puede usar una consulta como esta en SQL:

```sql
SELECT columna_categorica, COUNT(*) AS frecuencia
FROM staging
GROUP BY columna_categorica
ORDER BY frecuencia DESC;
```

üìå **Esto permite identificar los valores m√°s frecuentes en cada categor√≠a y detectar posibles errores o inconsistencias.**

### 7. Conteo de valores nulos (Para contar los valores nulos contamos las casillas que dijeran 'se ingora' o 'no especificado' ya que es lo mismo a no tener el dato, en realidad es un valor nulo)
```sql
--Para checar valores nulos:
WITH valores_nulos AS (
	SELECT 'sexo' AS columna, COUNT(*) as nulos
	FROM staging
	WHERE sexo IS NULL OR sexo=''
	UNION ALL
	SELECT 'fecha_nacimiento' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE fecha_nacimiento IS NULL
	UNION ALL
	SELECT 'nacionalidad' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE nacionalidad IS NULL OR nacionalidad ILIKE 'SE IGNORA'
	UNION ALL
	SELECT 'lengua_indigena' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE lengua_indigena IS NULL OR lengua_indigena ILIKE 'SE IGNORA' OR lengua_indigena ILIKE 'NO ESPECIFICADO'
	UNION ALL
	SELECT 'estado_civil' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE estado_civil IS NULL OR estado_civil ILIKE 'SE IGNORA'
	UNION ALL
	SELECT 'entidad_residencia' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE entidad_residencia IS NULL OR entidad_residencia ILIKE 'SE IGNORA'
	UNION ALL
	SELECT 'municipio_residencia' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE municipio_residencia IS NULL OR municipio_residencia ILIKE 'SE IGNORA' OR municipio_residencia ILIKE 'NO ESPECIFICADO'
	UNION ALL
	SELECT 'escolaridad' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE escolaridad IS NULL OR escolaridad ILIKE 'SE IGNORA' OR escolaridad ILIKE 'NO ESPECIFICADO'
	UNION ALL
	SELECT 'ocupacion' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE ocupacion IS NULL OR ocupacion ILIKE 'SE IGNORA' OR ocupacion ILIKE 'NO ESPECIFICADO'
	UNION ALL
	SELECT 'afiliacion_medica' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE afiliacion_medica IS NULL OR afiliacion_medica ILIKE 'SE IGNORA' OR afiliacion_medica ILIKE 'NO ESPECIFICADO' --Tambien hay valores que dicen ninguna, no se si esos contabilizarlos, porque realmente si se tiene la informacion que no tienen afiliaci√≥n m√©dica
	UNION ALL
	SELECT 'fecha_defuncion1' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE fecha_defuncion1 IS NULL
	UNION ALL
	SELECT 'hora_defuncion' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE hora_defuncion IS NULL
	UNION ALL
	SELECT 'lugar_defuncion' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE lugar_defuncion IS NULL OR estado_civil ILIKE 'SE IGNORA'
	UNION ALL
	SELECT 'entidad_defuncion' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE entidad_defuncion IS NULL OR entidad_defuncion ILIKE 'SE IGNORA'
	UNION ALL
	SELECT 'alcaldia' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE alcaldia IS NULL OR alcaldia ILIKE 'SE IGNORA' OR alcaldia ILIKE 'NO ESPECIFICADO'
	UNION ALL
	SELECT 'atencion_medica' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE atencion_medica IS NULL OR atencion_medica ILIKE 'SE IGNORA'
	UNION ALL
	SELECT 'necropsia' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE necropsia IS NULL OR necropsia ILIKE 'SE IGNORA'
	UNION ALL
	SELECT 'causa_defuncion' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE causa_defuncion IS NULL OR causa_defuncion ILIKE 'SE IGNORA' OR causa_defuncion ILIKE 'NO ESPECIFICADO'
	UNION ALL
	SELECT 'durante_embarazo' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE durante_embarazo IS NULL OR durante_embarazo ILIKE 'NO ESPECIFICADO'
	UNION ALL
	SELECT 'causado_embarazo' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE causado_embarazo IS NULL OR causado_embarazo ILIKE 'NO ESPECIFICADO' OR causado_embarazo ILIKE 'SE IGNORA'
	UNION ALL
	SELECT 'complicacion_embarazo' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE complicacion_embarazo IS NULL OR complicacion_embarazo ILIKE 'NO ESPECIFICADO'
	UNION ALL
	SELECT 'muerte_accidental_violenta' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE muerte_accidental_violenta IS NULL OR muerte_accidental_violenta ILIKE 'SE IGNORA' OR muerte_accidental_violenta ILIKE 'NO ESPECIFICADO'
	UNION ALL
	SELECT 'tipo_evento' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE tipo_evento IS NULL OR tipo_evento ILIKE 'SE IGNORA'
	UNION ALL
	SELECT 'en_trabajo' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE en_trabajo IS NULL OR en_trabajo ILIKE 'SE IGNORA'
	UNION ALL
	SELECT 'sitio_lesion' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE sitio_lesion IS NULL OR sitio_lesion ILIKE 'SE IGNORA' OR sitio_lesion ILIKE 'NO ESPECIFICADO'
	UNION ALL
	SELECT 'municipio_ocurrencia' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE municipio_ocurrencia IS NULL OR municipio_ocurrencia ILIKE 'SE IGNORA' OR municipio_ocurrencia ILIKE 'NO ESPECIFICADO'
	UNION ALL
	SELECT 'fecha_defuncion' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE fecha_defuncion IS NULL
	UNION ALL
	SELECT 'edad' AS columna, COUNT(*) AS nulos
	FROM staging
	WHERE edad IS NULL
)
SELECT *
FROM valores_nulos
WHERE nulos>0;
```
El resultado que obtuvimos fue el siguiente:
| Columna                | Nulos  |
|------------------------|--------|
| tipo_evento            | 1583   |
| sitio_lesion           | 820    |
| ocupacion              | 6611   |
| necropsia              | 646    |
| nacionalidad           | 1038   |
| municipio_residencia   | 9267   |
| municipio_ocurrencia   | 17453  |
| lugar_defuncion        | 3196   |
| lengua_indigena        | 2627   |
| hora_defuncion         | 226    |
| fecha_nacimiento       | 834    |
| estado_civil           | 3196   |
| escolaridad            | 3134   |
| entidad_residencia     | 1039   |
| en_trabajo             | 854    |
| edad                   | 834    |
| durante_embarazo       | 6429   |
| complicacion_embarazo  | 6888   |
| causado_embarazo       | 7168   |
| atencion_medica        | 755    |
| alcaldia               | 3897   |
| afiliacion_medica      | 9935   |




  
  
